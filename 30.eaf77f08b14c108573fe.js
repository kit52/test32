"use strict";(self.webpackChunkproduction_project=self.webpackChunkproduction_project||[]).push([[30],{1889:function(e,a,t){t.r(a),t.d(a,{default:function(){return K}});var s=t(2327),r=t(7294),i=t(6974),n=t(2576),l=t(3007),c=t(1233),d=t(1492),o=t(9457),m=t(8699);const u=t(6628).p.injectEndpoints({endpoints:e=>({getArticleRecommendationsList:e.query({query:e=>({url:"/articles",params:{_limit:e}})})})}).useGetArticleRecommendationsListQuery;var x=t(5893);const g=(0,r.memo)((e=>{const{className:a}=e,{t:t}=(0,s.$)(),{isLoading:r,data:i,error:c}=u(3);return r||c||!i?null:(0,x.jsxs)(o.g,{gap:"8",className:(0,l.A)("",{},[a]),children:[(0,x.jsx)(m.xv,{size:m.yH.L,title:t("Рекомендуем")}),(0,x.jsx)(n.wD,{articles:i,target:"_blank"})]})}));var h=t(743);const j=(0,r.lazy)((()=>t.e(933).then(t.bind(t,1933))));var v=t(9960),p=t(7050),C=t(516),L={CommentCard:"xIHByGcu",header:"dsH_3Oqu",username:"dw82WMzO",loading:"V0iZ1Un3"},N=t(776);const f=(0,r.memo)((e=>{const{className:a,comment:t,isLoading:s}=e;return s?(0,x.jsxs)(o.g,{gap:"8",max:!0,className:(0,l.A)(L.CommentCard,{},[a,L.loading]),children:[(0,x.jsxs)("div",{className:L.header,children:[(0,x.jsx)(p.O,{width:30,height:30,border:"50%"}),(0,x.jsx)(p.O,{height:16,width:100,className:L.username})]}),(0,x.jsx)(p.O,{className:L.text,width:"100%",height:50})]}):t?(0,x.jsxs)(o.g,{gap:"8",max:!0,className:(0,l.A)(L.CommentCard,{},[a]),children:[(0,x.jsxs)(C.F,{to:(0,N.CJ)(t.user.id),className:L.header,children:[t.user.avatar?(0,x.jsx)(v.q,{size:30,src:t.user.avatar}):null,(0,x.jsx)(m.xv,{className:L.username,title:t.user.username})]}),(0,x.jsx)(m.xv,{className:L.text,text:t.text})]}):null})),w=(0,r.memo)((e=>{const{className:a,isLoading:t,comments:r}=e,{t:i}=(0,s.$)();return t?(0,x.jsxs)(o.g,{gap:"16",max:!0,className:(0,l.A)("",{},[a]),children:[(0,x.jsx)(f,{isLoading:!0}),(0,x.jsx)(f,{isLoading:!0}),(0,x.jsx)(f,{isLoading:!0})]}):(0,x.jsx)(o.g,{gap:"16",max:!0,className:(0,l.A)("",{},[a]),children:null!=r&&r.length?r.map((e=>(0,x.jsx)(f,{isLoading:t,comment:e},e.id))):(0,x.jsx)(m.xv,{text:i("Комментарии отсутствуют")})})}));var y=t(9970),A=t(3053),S=t(4268);const b=(0,S.hg)("articleDetails/fetchCommentsByArticleId",(async(e,a)=>{const{extra:t,rejectWithValue:s}=a;if(!e)return s("error");try{const a=await t.api.get("/comments",{params:{articleId:e,_expand:"user"}});if(!a.data)throw new Error;return a.data}catch(e){return s("error")}})),I=(0,S.HF)({selectId:e=>e.id}),k=I.getSelectors((e=>{var a;return(null===(a=e.articleDetailsPage)||void 0===a?void 0:a.comments)||I.getInitialState()})),D=(0,S.oM)({name:"articleDetailsCommentsSlice",initialState:I.getInitialState({isLoading:!1,error:void 0,ids:[],entities:{}}),reducers:{},extraReducers:e=>{e.addCase(b.pending,(e=>{e.error=void 0,e.isLoading=!0})).addCase(b.fulfilled,((e,a)=>{e.isLoading=!1,I.setAll(e,a.payload)})).addCase(b.rejected,((e,a)=>{e.isLoading=!1,e.error=a.payload}))}}),{reducer:O}=D,z=e=>{var a,t;return null===(a=e.articleDetailsPage)||void 0===a||null===(t=a.comments)||void 0===t?void 0:t.isLoading};var q=t(4420);const P=(0,S.hg)("articleDetails/addCommentForArticle",(async(e,a)=>{const{extra:t,dispatch:s,rejectWithValue:r,getState:i}=a,l=(0,q.m5)(i()),c=(0,n.wq)(i());if(!l||!e||!c)return r("no data");try{const a=await t.api.post("/comments",{articleId:c.id,userId:l.id,text:e});if(!a.data)throw new Error;return s(b(c.id)),a.data}catch(e){return r("error")}}));var U=t(5401);const _=(0,r.memo)((e=>{const{className:a,id:t}=e,{t:i}=(0,s.$)(),n=(0,h.v9)(k.selectAll),c=(0,h.v9)(z),d=(0,U.T)(),u=(0,r.useCallback)((e=>{d(P(e))}),[d]);return(0,y.Q)((()=>{d(b(t))})),(0,x.jsxs)(o.g,{gap:"16",max:!0,className:(0,l.A)("",{},[a]),children:[(0,x.jsx)(m.xv,{size:m.yH.L,title:i("Комментарии")}),(0,x.jsx)(r.Suspense,{fallback:(0,x.jsx)(A.a,{}),children:(0,x.jsx)(j,{onSendComment:u})}),(0,x.jsx)(w,{isLoading:c,comments:n})]})}));var E=t(7779);const H=(0,S.hg)("articleDetailsPage/fetchArticleRecommendations",(async(e,a)=>{const{extra:t,rejectWithValue:s}=a;try{const e=await t.api.get("/articles",{params:{_limit:4}});if(!e.data)throw new Error;return e.data}catch(e){return s("error")}})),R=(0,S.HF)({selectId:e=>e.id}),W=(R.getSelectors((e=>{var a;return(null===(a=e.articleDetailsPage)||void 0===a?void 0:a.recommendations)||R.getInitialState()})),(0,S.oM)({name:"articleDetailsPageRecommendationsSlice",initialState:R.getInitialState({isLoading:!1,error:void 0,ids:[],entities:{}}),reducers:{},extraReducers:e=>{e.addCase(H.pending,(e=>{e.error=void 0,e.isLoading=!0})).addCase(H.fulfilled,((e,a)=>{e.isLoading=!1,R.setAll(e,a.payload)})).addCase(H.rejected,((e,a)=>{e.isLoading=!1,e.error=a.payload}))}})),{reducer:$}=W,F=(0,E.UY)({recommendations:$,comments:O});var T=t(9499);const V=(0,t(2222).P1)(n.wq,q.m5,((e,a)=>!(!e||!a)&&e.user.id===a.id)),M=(0,r.memo)((e=>{const{className:a}=e,{t:t}=(0,s.$)(),c=(0,i.s0)(),d=(0,h.v9)(V),m=(0,h.v9)(n.wq),u=(0,r.useCallback)((()=>{c((0,N.k7)())}),[c]),g=(0,r.useCallback)((()=>{m&&c((0,N.mK)(m.id))}),[m,c]);return(0,x.jsxs)(o.U,{max:!0,justify:"between",className:(0,l.A)("",{},[a]),children:[(0,x.jsx)(T.zx,{theme:T.bn.OUTLINE,onClick:u,children:t("Назад к списку")}),d&&(0,x.jsx)(T.zx,{theme:T.bn.OUTLINE,onClick:g,children:t("Редактировать")})]})})),B=(0,r.lazy)((()=>t.e(785).then(t.bind(t,5785)))),G=e=>(0,x.jsx)(r.Suspense,{fallback:(0,x.jsx)(p.O,{width:"100%",height:140}),children:(0,x.jsx)(B,{...e})}),Q={articleDetailsPage:F},J=e=>{const{className:a}=e,{t:t}=(0,s.$)("article-details"),{id:r}=(0,i.UO)();return r?(0,x.jsx)(c.W,{reducers:Q,removeAfterUnmount:!0,children:(0,x.jsx)(d.T,{className:(0,l.A)("adu8fSDx",{},[a]),children:(0,x.jsxs)(o.g,{gap:"16",max:!0,children:[(0,x.jsx)(M,{}),(0,x.jsx)(n.D0,{id:r}),(0,x.jsx)(G,{articleId:r}),(0,x.jsx)(g,{}),(0,x.jsx)(_,{id:r})]})})}):null};var K=(0,r.memo)(J)}}]);